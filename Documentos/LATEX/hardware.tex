%---------- Inicio do Texto ----------
% recomenda-se a escrita de cada capitulo em um arquivo texto separado (exemplo: intro.tex, fund.tex, exper.tex, concl.tex, etc.) e a posterior inclusao dos mesmos no mestre do documento utilizando o comando \input{}, da seguinte forma:
%\input{intro.tex}
%\input{fund.tex}
%\input{exper.tex}
%\input{concl.tex}

\def\inputGnumericTable{}

\section{\textit{Hardware}}
O Sistema Integrado de Acompanhamento de Encomendas Rodoviárias utilizou inicialmente, devido a disponibilidade, baixo custo e possibilidade tanto de trabalhar com RF quanto de se comunicar viar uart, o kit de desenvolvimento EZ430-RF2500, da Texas Instruments. O problema deste kit se dá na frequência de operação de sua comunicação sem fio (2.4GHz) e no tamanho de sua antena. Esses fatores levam este kit a ser um excelente escolha caso a distância em um transmissor e um receptor for pequena (até 10 metros). No caso do projeto SIAER, a distância entre guichê e ônibus é bem significativa, e um sistema de comunicação mais robusto se faz necessário.

Através de contatos com a filial da Texas Instruments em Freising, Alemanha, uma parceria foi criada. Recebi gratuitamente os kits de desenvolvimento necessários e o compilador Code Composer para que pudesse tornar viável as melhorias sugeridas no início deste relatório. Em contrapartida, eu deveria usar preferencialmente as ferramentas daquela empresa e no fim do projeto reportar os resultados, adicionando minha experiência como usuário e sugerindo possíveis melhorias. O kit de desenvolvimento escolhido foi o EM430F6137RF900, no qual está incluso:

\begin{itemize}
	\item 2 placas baseadas no processador XCC430F6137
  \item 2 antenas de 868-915 MHz
  \item 2 pushbuttons 
  \item 18 barras de pinos 4x2 
  \item 2 conjuntos de baterias AAA para alimentação  
	\item Arquitetura voltada ao baixo consumo;
\end{itemize}

Este kit possui bem menos funcionalidades que o EZ430-RF2500. Ele é basicamente um microprocessor e acoplado, com as devidas precauções de impedância, a uma antena, sendo que praticamente todos os pinos de I/O estão disponíveis ao usuário. Além disso, diferentemente EZ430-RF2500, ele não possui um canal de comunicação uart pronto para ser usado. Em suma, ele serve basicamente para testar as capacidades de comunicação RF deste microprocessador. No entanto, nesse quesito ele é bem superior ao EZ430.  

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/IMG/EM430F6137RF900.png} % <- formatos PNG, JPG e PDF
	\caption[Kit de Desenvolvimento EM430F6137RF900]{Kit de Desenvolvimento EM430F6137RF900}
	\fonte{Texas Instruments}
	\label{fig:Kit_cc430}
\end{figure}

Também foi fornecido o MSP-FET430UIF, através do qual é possível escrever os códigos criados com o Code Composer, na memória dos processadores.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/IMG/msp-fet430uif.png} % <- formatos PNG, JPG e PDF
	\caption[Programador USB]{Programador USB}
	\fonte{Texas Instruments}
	\label{fig:Programador_USB}
\end{figure}

\subsection{Comunicação UART}
%descrever pq usar o outro modulo.
Para que este projeto se torne viável, é necessária a comunicação entre o kit de desenvolvimento e o PC. Na última versão apresentada, esta comunicação se deu através da comunicação serial entre kit e PC. Vale lembrar que o kit utilizado anteriormente contava com um canal pronto para comunicação serial. Ao escolher o EM430F6137RF900 como base para o novo projeto, acabamos por perder tal conectividade.

Após extensa pesquisa dentre as possíveis soluções, encontrou-se uma solução não trivial, mas que se adequou muito bem ao nosso protótipo. Outro produto da família EZ430 da Texas Instruments se utiliza de uma interface USB de debug  totalmente compatível com o EM430F6137RF900. Seu nome é EZ430-CHRONOS. Sua placa de debug é praticamente idêntica a do EZ430-RF2500, diferenciando-se somente em seu firmware, o qual possibilita a programação de dispositivos da família CC430. As vantagens ao se utilizar tal placa seriam que a alimentação do circuito viria através do USB, haveria um canal de comunicação uart e a programação das placas seria facilitada. O único problema seria interfacear os pinos da EM430F6137RF900 com o da placa de debug.

\subsection{Características da placa de debug}
As principais vantagens da utilização desta placa são a alimentação do circuito provém da conexão USB, o canal para comunicação serial entre PC e o kit de desenvolvimento e a facilidade para programação.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.65\textwidth]{./figs/IMG/debug.png} % <- formatos PNG, JPG e PDF
	\caption[A placa de Debug]{A placa de Debug}
	\fonte{Texas Instruments}
	\label{fig:debug}
\end{figure}

Um conector USB convencional oferece 4 linhas: GND, D+, D- e +5V. As linhas D+ e D- são utilizadas para a transmissão das informações, adotando o padrão NRZI (\textit{Non return to zero inverted}). Caso os descritores USB sejam configurados no modo \textit{BusPower Mode}, o dispositivo conectado ao barramento USB pode obter até 500 mA, em pacotes quantizado de 100mA. 

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/TPS7730.png} % <- formatos PNG, JPG e PDF
	\caption[Conexões recomendadas para o TPS7730]{Conexões recomendadas para o TPS7730}
	\fonte{\textit{datasheet} do TPS7730}
	\label{fig:TPS7730}
\end{figure}


Na placa de debug, há a necessidade da utilização de algum controlador para transformar o sinal do barramento de 5V para, no nosso caso, 3,3V. Por isso, utilizou-se o TPS7730, o qual é um regulador linear de tensão, podendo fornecer até 250mA a uma carga. Sua tensão de saída pode ser regulada até 5,5V de acordo com os resistores conectados ao componente. No \textit{datasheet} do componente, a  nota explicativa da figura ~\ref{fig:TPS7730} especifica um esquema de conexão recomendável. Conforme é notado observando-se a figura ~\ref{fig:TPS7730}, o arranjo dos componentes R1 e R2 determinará o valor da tensão de saída. No \textit{datasheet}, uma série de equações é apresentada para que se obtenham os valores adequados. Para se fornecer a tensão de 3,3V para os demais componentes, utilizou-se R1=53,8 k e R2=30,1 k.

Para a comunicação serial utiliza-se um conversor Serial-USB TUSB3410. Este circuito proporciona a conectividade entre um dispositivo serial e uma interface USB. O diagrama a seguir rapresenta tal dispositivo ~\ref{fig:TUSB3410}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.6\textwidth]{./figs/TUSB3410.png} % <- formatos PNG, JPG e PDF
	\caption[Conexões efetuadas pelo TUSB3410]{Conexões efetuadas pelo TUSB3410}
	\fonte{\textit{datasheet} do TUSB3410}
	\label{fig:TUSB3410}
\end{figure}

Como características principais, podem-se citar:
\begin{itemize}
	\item	Compatibilidade com a especificação USB 2.0 (\textit{full speed});
	\item	Desde que adequadamente configurado, suporta transmissões de até 12 Mbps;
	\item	Suporta operação sobre modo \textit{self-powered} ou \textit{bus-powered}, obtendo alimentação através da linha +5V do barramento USB.
\end{itemize}

Neste projeto, toda comunicação entre kit e PC passa por este dispositivo. Ele é reconhecido no windows como uma porta virtual de COM através de um driver apropriado que é instalado ao se conectar o dispositivo na porta USB. Esta porta é chamada de virtual por não haver, de fato, nenhum dispositivo serial conectado ao PC, mas sim, um conjunto da atividade de um driver USB e do kit de desenvolvimento, o qual, no fim das contas, se comporta como uma porta convencional de comunicação serial. Vale lembrar que para o driver necessário pode ser encontrado nas respectivas pastas dos compiladores IAR ou Code Composer. O \textit{baud-rate} adotado no projeto foi de 9600 bps.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.65\textwidth]{./figs/virtual_com.png} % <- formatos PNG, JPG e PDF
	\caption[Porta de COM Virtual]{Visualização do aspecto do Gerenciador de Dispositivos após conexão da plataforma com o TUSB3410}
	\fonte{\textit{datasheet} do TUSB3410}
	\label{fig:virtual_com}
\end{figure}

\subsection{O microprocessador CC430F6137}

A família de chips \textit{ultra-low-power} com núcleos de transceiver RF embutido CC430 da Texas Instruments consiste de diversos dispositivos que apresentam os mais diversos periféricos. Estes dispositivos apresentam cinco modos de economia de energia (\textit{low-power modes}) e são voltados para aplicações onde a vida útil da bateria é crucial. O dispositivo apresenta um microprocessador RISC MSP430 de 16 bits.

Sua principal vantagem em relação a outros microprocessadores é que em um único chip temos um processador e um transceiver RF, o que garante performance, além de projetos mais simples e fáceis de usar.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.65\textwidth]{./figs/IMG/CC430F6137.png} % <- formatos PNG, JPG e PDF
	\caption[O microprocessador CC430F6137]{O microprocessador CC430F6137}
	\fonte{\textit{datasheet} do TUSB3410}
	\label{fig:cc430f6137}
\end{figure}

Como características principais, podemos citar:
\begin{itemize}
	\item System-on-Chip para comunicações wireless de baixo consumo
	\item Tensão de alimentação de 1.8 V até 3.6 V
	\item CPU modo ativo - 160 µA por MHz
	\item Modo Standby - LMP3 2.0 µA
	\item Modo desligado - LPM4 1.0 µA
	\item Rádio em RX - 15 mA, 250 kbps, 915 MHz
	\item Periféricos do MSP430
	\item Arquitetura RISC de 16 bits, memória extendida, clock de até 20MHz
	\item Saída do modo Standby Mode em menos de 6 µs
	\item Sistema de controle de energia com SVS e Brownout
	\item Clock unificado com FLL
	\item Dois timers de 16 bits 
	\item Real time clock
	\item Duas interfaces de comunicação serial
	\item USCI_A0 com suporte a UART, IrDA, SPI
	\item USCI_B0 com suporte a I2C, SPI
	\item Conversor AD de 12 bits com referência interna, Sample-and-Hold, e Autoscan
	\item Comparador
\end{itemize}

Possui uma memória \textit{flash} de 32KB + 256B. Ainda, para dados voláteis, o MSP430 apresenta uma memória RAM de tamanho 4KB.
\newpage
\subsection{Interface da EM430F6137RF900 com placa de debug}
Falar do motivo novamente 

O software utilizado para o layout da placa de circuito impresso foi o EAGLE. Este é um dos softwares de layout de placas de circuito impresso mais conhecidos e utilizados no mundo. Extremamente popular entre hobbistas e estudantes de eletrônica, possui uma licensa gratuita, na qual há limitaçõés para o tamanho da placa e de número de páginas de esquemático. Para nossa aplicação, assim como o de muitos outros usuários, esta licensa é mais do que suficiente.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.2\textwidth]{./figs/IMG/conector_ez430.png} % <- formatos PNG, JPG e PDF
	\caption[Conector do EZ430]{Conector da placa de debug}
	\fonte{Texas Instruments}
	\label{fig:conector_ez430}
\end{figure}

A placa de interfaceamento é relativamente simples, basta conectar os seis pinos da placa de debug (~\ref{fig:conector_ez430}) aos correspontes pinos da placa EM430F6137RF900(~\ref{fig:jtag}). A sequencia é a seguinte: GND-GND, 3.6V - Vcc, TEST-TST,RST-RST e os pinos TX e RX com os pinos P1.5 E P1.6 do CC430.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.5\textwidth]{./figs/IMG/jtag.png} % <- formatos PNG, JPG e PDF
	\caption[Sinais do conector Jtag]{Sinais da JTAG da placa EM430F6137RF900}
	\fonte{Elptronic}
	\label{fig:jtag}
\end{figure}

Durante a compra dos componentes necessários, notou-se que não havia o conector macho da placa de debug (MOLEX com distancia de 0.1 mm) em nenhuma loja online no Brasil. Buscando no site americano de componentes eletrônica digikey, verificou-se que o preço de importação e o tempo necessário seriam proibitivos. Neste ponto optou-se pela utilização de uma barra de pinos de 2.54mm. A seguir temos as figuras do esquemático final e do layout da placa.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./figs/IMG/interface_esquematico.png} % <- formatos PNG, JPG e PDF
	\caption[Esquematico]{Esquemático da placa de interfaceamento}
	\fonte{Próprio}
	\label{fig:esquematico_eagle}
\end{figure}
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.8\textwidth]{./figs/IMG/placa.png}
	\caption[Placa no eagle]{Layout da placa}
	\fonte{Próprio}
	\label{fig:circuito_eagle}
\end{figure}
\newpage

A placas foram confeccionadas dentro da própria UTFPR sob a supervisão do professor Fernando Castaldo.

% TIRAR FOTO!!!!
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{./figs/IMG/placa.png}
	\caption[Placa de circuito impresso]{Placa de circuito impresso}
	\fonte{Próprio}
	\label{fig:pcb}
\end{figure}
\newpage
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{./figs/IMG/placa.png}
	\caption[Resultado final]{Resultado final}
	\fonte{Próprio}
	\label{fig:pcb_final}
\end{figure}

A figura ~\ref{fig:pcb_final} mostra o resultado final, da placa de interfaceamento, juntamente com o kit de desenvolvimento e a placa de debug. Foi com esta plataforma de desenvolvimento que todo o projeto foi realizado.
